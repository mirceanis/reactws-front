machine:
  environment:
    YARN_VERSION: 0.18.0
    ANDROID_HOME: /usr/local/android-sdk-linux
    PATH: "${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${PATH}:${HOME}/.yarn/bin:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  node:
    version: v7.3.0
  java:
    version: oraclejdk8
dependencies:
  pre:
    - |
      if [[ ! -e ~/.yarn/bin/yarn || $(yarn --version) != "${YARN_VERSION}" ]]; then
        echo "Download and install Yarn."
        curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version $YARN_VERSION
      else
        echo "The correct version of Yarn is already installed."
      fi
    - echo y | android update sdk --no-ui --all --filter "platform-tools, tools"
    - mkdir -p ${HOME}/.android && touch ${HOME}/.android/repositories.cfg
    - yes | $ANDROID_HOME/tools/bin/sdkmanager --update
    - yes | $ANDROID_HOME/tools/bin/sdkmanager --licenses
    - yes | $ANDROID_HOME/tools/bin/sdkmanager "build-tools;25.0.3"
    - yes | $ANDROID_HOME/tools/bin/sdkmanager "platforms;android-25"
    - yes | $ANDROID_HOME/tools/bin/sdkmanager "tools" "platform-tools"
    - yes | $ANDROID_HOME/tools/bin/sdkmanager "extras;android;m2repository" "extras;google;m2repository"
    
  override:
    - yarn install
    - cd android && ./gradlew dependencies
  cache_directories:
    - ~/.yarn
    - ~/.cache/yarn
    - ~/.gradle
    - android/.gradle
general:
  artifacts:
    - "android/app/build/reports"
    - "android/app/build/outputs/apk"
test:
  override:
    - yarn test -- --maxWorkers 2
    - cd android && ./gradlew lint test
